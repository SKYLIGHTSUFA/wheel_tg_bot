#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ webhook

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ webhook..."
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å webhook —á–µ—Ä–µ–∑ API
echo "1. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ webhook:"
curl -s http://localhost:8000/api/webhook-info | python3 -m json.tool 2>/dev/null || echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ webhook"
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo "2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:"
echo "   USE_WEBHOOK: ${USE_WEBHOOK:-–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ}"
echo "   WEBAPP_URL: ${WEBAPP_URL:-–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ}"
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω –ª–∏ —Å–µ—Ä–≤–µ—Ä
echo "3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞:"
if curl -s http://localhost:8000/api/health > /dev/null 2>&1; then
    echo "   ‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8000"
    curl -s http://localhost:8000/api/health | python3 -m json.tool 2>/dev/null || echo "   ‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è health check"
else
    echo "   ‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8000"
fi
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ Tuna
if [ -n "$WEBAPP_URL" ]; then
    echo "4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ Tuna:"
    if curl -s "${WEBAPP_URL}/api/health" > /dev/null 2>&1; then
        echo "   ‚úÖ Tuna —Ç—É–Ω–Ω–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω: ${WEBAPP_URL}"
    else
        echo "   ‚ùå Tuna —Ç—É–Ω–Ω–µ–ª—å –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω: ${WEBAPP_URL}"
        echo "   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç—É–Ω–Ω–µ–ª—å –∑–∞–ø—É—â–µ–Ω: tuna http 8000"
    fi
else
    echo "4. WEBAPP_URL –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
fi
echo ""

echo "üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:"
echo "   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ —Å USE_WEBHOOK=true"
echo "   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Tuna —Ç—É–Ω–Ω–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω: tuna http 8000"
echo "   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫"
