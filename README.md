# Telegram Bot –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞ —à–∏–Ω

Telegram –±–æ—Ç —Å WebApp –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –¥–ª—è –∑–∞–∫–∞–∑–∞ —à–∏–Ω. –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ **Tuna** —Ç—É–Ω–Ω–µ–ª—å (tuna.am).

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.8+
- Tuna CLI (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- Telegram Bot Token
- –ê–∫–∫–∞—É–Ω—Ç –Ω–∞ [tuna.am](https://tuna.am) (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python

```bash
pip install -r requirements.txt
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Tuna CLI

**macOS (—á–µ—Ä–µ–∑ Homebrew):**
```bash
brew install tuna
```

**Linux/macOS (—á–µ—Ä–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç):**
```bash
curl -sSL https://tuna.am/install.sh | bash
```

**–ß–µ—Ä–µ–∑ pip:**
```bash
pip install tuna-cli
```

**Windows:**
–°–∫–∞—á–∞–π—Ç–µ –±–∏–Ω–∞—Ä–Ω–∏–∫ —Å [tuna.am](https://tuna.am) –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ WSL.

### 3. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω Tuna (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [tuna.am](https://tuna.am)
2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
export TUNA_TOKEN="tt_dzlsgcyntgvbpv0uregz8jw9d88rhxq9"
```

### 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
export BOT_TOKEN="8576138519:AAES_lBttGBQ-cvJ_HvcDjTNzYyoGYBOneE"
export USE_WEBHOOK="true"  # –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è webhook —á–µ—Ä–µ–∑ Tuna
export TUNA_LOCATION="ru"  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Ä–µ–≥–∏–æ–Ω (ru, nl, us –∏ —Ç.–¥.)
<<<<<<< HEAD
export WEBAPP_URL='ht.tps://vsnsgb-185-229-221-157.ru.tuna.am'
=======
export WEBAPP_URL='https://wheel.ru.tuna.am'
>>>>>>> 8526864 ([ADD] tune)
curl -X POST "http://localhost:8000/api/set-webhook?webhook_url=https://wheel.ru.tuna.am/api/webhook"

```

## –ó–∞–ø—É—Å–∫

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
chmod +x start_tuna.sh
./start_tuna.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç –Ω–∞–ª–∏—á–∏–µ Tuna CLI
- –ó–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –ø–æ—Ä—Ç—É 8000
- –ó–∞–ø—É—Å—Ç–∏—Ç Tuna HTTP —Ç—É–Ω–Ω–µ–ª—å
- –ü–æ–∫–∞–∂–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ webhook

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

**–®–∞–≥ 1:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```bash
export USE_WEBHOOK=true
python bot.py
```

**–®–∞–≥ 2:** –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç–µ Tuna —Ç—É–Ω–Ω–µ–ª—å
```bash
# –° —Ç–æ–∫–µ–Ω–æ–º –∏ —Ä–µ–≥–∏–æ–Ω–æ–º
tuna http 8000 --token="$TUNA_TOKEN" --location="ru"

# –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ
tuna http 8000
```

**–®–∞–≥ 3:** –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ Tuna –≤—ã–¥–∞—Å—Ç –ø—É–±–ª–∏—á–Ω—ã–π URL –≤–∏–¥–∞: `https://xxxxx.tuna.am`

**–®–∞–≥ 4:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ WEBAPP_URL –∏ webhook
```bash
export WEBAPP_URL="https://xxxxx.tuna.am"
curl -X POST "http://localhost:8000/api/set-webhook?webhook_url=https://xxxxx.tuna.am/api/webhook"
```

–ò–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å WEBAPP_URL:
```bash
export USE_WEBHOOK=true
export WEBAPP_URL="https://xxxxx.tuna.am"
python bot.py
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: Polling (–±–µ–∑ —Ç—É–Ω–Ω–µ–ª—è, –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å polling –±–µ–∑ webhook:

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ USE_WEBHOOK –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ —Ä–∞–≤–µ–Ω false
unset USE_WEBHOOK
python bot.py
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã–π webhook –∏ –∑–∞–ø—É—Å—Ç–∏—Ç polling.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ –≤ Telegram: `@–≤–∞—à_–±–æ—Ç`
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start`
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üõû –û—Ç–∫—Ä—ã—Ç—å –º–∞–≥–∞–∑–∏–Ω"
4. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏ –æ—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑

## –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

- `/setadmin` - –î–æ–±–∞–≤–∏—Ç—å —Å–µ–±—è –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã
- `/add` - –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä
- `/products` - –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
- `/cancel` - –û—Ç–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é –æ–ø–µ—Ä–∞—Ü–∏—é
- `/webhook` - –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º webhook
- `/deletewebhook` - –£–¥–∞–ª–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π webhook (–¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ polling)

## API Endpoints

- `GET /` - WebApp –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- `GET /api/products` - –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
- `POST /api/order` - –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
- `POST /api/webhook` - Webhook –¥–ª—è Telegram
- `POST /api/set-webhook` - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook
- `GET /api/webhook-info` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ webhook
- `GET /api/health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
wheel_tg_bot/
‚îú‚îÄ‚îÄ bot.py              # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ index.html          # WebApp –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ requirements.txt    # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ db.sqlite3         # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ start_tuna.sh      # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ —á–µ—Ä–µ–∑ Tuna
‚îî‚îÄ‚îÄ README.md          # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- `BOT_TOKEN` - –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `WEBAPP_URL` - URL –¥–ª—è WebApp (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://xxxxx.tuna.am`)
- `USE_WEBHOOK` - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å webhook –≤–º–µ—Å—Ç–æ polling (`true`/`false`, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `false`). **–í–∞–∂–Ω–æ:** –ø—Ä–∏ `USE_WEBHOOK=true` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `WEBAPP_URL`
- `TUNA_TOKEN` - –¢–æ–∫–µ–Ω Tuna (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã)
- `TUNA_LOCATION` - –†–µ–≥–∏–æ–Ω –¥–ª—è Tuna —Ç—É–Ω–Ω–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: `ru`, `nl`, `us` –∏ —Ç.–¥.)
- `DB_PATH` - –ü—É—Ç—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `db.sqlite3`)
- `PORT` - –ü–æ—Ä—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `8000`)
- `SHOP_ADDRESS` - –ê–¥—Ä–µ—Å –º–∞–≥–∞–∑–∏–Ω–∞
- `SHOP_PHONE` - –¢–µ–ª–µ—Ñ–æ–Ω –º–∞–≥–∞–∑–∏–Ω–∞
- `ORDERS_CHAT` - –ß–∞—Ç –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–∞–∫–∞–∑–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `@KolesaUfa02`)

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ webhook (`USE_WEBHOOK=true`) —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `WEBAPP_URL` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–π webhook –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º polling
- –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç webhook/polling, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `USE_WEBHOOK=false` –∏–ª–∏ —É–¥–∞–ª–∏—Ç–µ webhook –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ API
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
- –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–∞–ø–∫–µ `uploads/`

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "Conflict: can't use getUpdates method while webhook is active"

–≠—Ç–∞ –æ—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞ webhook –∞–∫—Ç–∏–≤–µ–Ω, –Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å polling. –†–µ—à–µ–Ω–∏–µ:

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `USE_WEBHOOK=true` –∏ `WEBAPP_URL` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è webhook
2. –ò–ª–∏ —É–¥–∞–ª–∏—Ç–µ webhook –≤—Ä—É—á–Ω—É—é:
```bash
curl -X POST "http://localhost:8000/api/set-webhook?webhook_url="
```
3. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `/deletewebhook` –≤ –±–æ—Ç–µ (–µ—Å–ª–∏ –≤—ã –∞–¥–º–∏–Ω)

### Tuna CLI –Ω–µ –Ω–∞–π–¥–µ–Ω

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Tuna CLI:
```bash
curl -sSL https://tuna.am/install.sh | bash
```

–ò–ª–∏ —á–µ—Ä–µ–∑ Homebrew (macOS):
```bash
brew install tuna
```

### Tuna —Ç—É–Ω–Ω–µ–ª—å –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –Ω–∞ –ø–æ—Ä—Ç—É 8000
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç 8000 –Ω–µ –∑–∞–Ω—è—Ç –¥—Ä—É–≥–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω: `tuna http 8000 --token="$TUNA_TOKEN"`

### URL –æ—Ç Tuna –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8000
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Tuna —Ç—É–Ω–Ω–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω (–Ω–µ –∑–∞–∫—Ä—ã—Ç)
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL (HTTPS, –Ω–µ HTTP)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Tuna.am](https://tuna.am) - –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç Tuna
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Tuna](https://tuna.am/docs) - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [Telegram Bot API](https://core.telegram.org/bots/api) - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Telegram Bot API
